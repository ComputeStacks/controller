require 'test_helper'

class Deployment::SslTest < ActiveSupport::TestCase

  setup do
    @valid_pkey = "-----BEGIN PRIVATE KEY-----\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDa75w08SOOBein\ncybGBX/zGtZfdNHAD5SiIw7200aqUI0Mi6JBRfKbWsacWRRGeP/dF0Pd4LY4p77o\nZs49iW+r6nvDaSxn9NmGklZ13c3MIp80LE0O6j15p+0lt9zdwz0cV0aPyyzFGJ3Q\n6+nTOO/yH1sryCZSxmpZqamPxUu/G0zQmQwRQpLg56w0Cjt8Rr9fE/jOTUrfAjAA\nQu8sly4gpfSZ8vVKfA8yXJF33pOLa91PSd24yX9SKqaaGoLFKT6HRGm0XCeo3MFI\n6HH6ezyO/idmv55yaSw8TL1yFtZt7UwdvsvrrqtGC5NKRJ3+umT9J1wYzCZZspUU\nw3D3z0c/AgMBAAECggEALmepQWN3OMwx0wRKTKCvzRR8KcF2D/J9e5xYuKJxkPn/\n24/hNVqhIKKuBEexT3qoKPGcdfQCS6HqihH4VvzBibvqvbGWMvaoAKkV4GfCDims\nev+E2ct2eknIrzz4eJzAYDhzgVj8RU6BbN4EMrwXx8czqOUEknjx481dXlbgRkIb\niF5C+DtHBFHXnPY1Ph5ohStbSfLUY2k68yZOJDb5vLXTB/I7yoh75Dy1L202fywt\nM6SHtjrBYlyRLYWk2oJdDQd838qqeN6wiccQFoXZN6i+sHjk/xfPDZnpadHMR5m4\nz6kERTRnEmVac8Ws4OZK+tOEqJmvnKVrQJ6MJSdNeQKBgQD8Cp/7SwClBLU0tG/k\nxacLTEuVlQKV1oM0KQxHyKnPfh8nn5MFChhrLRXtANBlZTQPgXN2GQ1ls2juRdta\nyvg6CjRLXTYudaJnSwqpoAnvLsB6IBICMaeP6YZcVY09ln6z1aGdEz/pnJwySn8I\n9dLBicdQQ+d0OlrtERFkN6eugwKBgQDeX+ECWo2AsWg52zx05PYWdMqgpId2Rv8Y\nzeukRCczjZ4U3+MamyqYMbdURvKmAXUvR4fMNwemAvnA13v76Qem70b3MRBLvA/P\nNhB3JLj/IneJwk8UD7hDq9zAivYbOIRaJlrZLrSr+XJiuqjzGvGhG6ScwbPDKc9D\ngDmstABnlQKBgQC0GC96k3xRbczBbVEq6iTTiN/VcZVYVeCIq/APdw4Hqro+SOL3\nzd/m7V9ma5d9bFRH5BsJvxr4mbsXzyjPdorqhhIZ6+/kQMAcCN4EmMugcgqs+S+F\nC9AMoDQW1DbJVDkS7Uq+/1tC5VojAWJGl8jR7E5UR0EipvQDw5dmwfH6WwKBgQCs\ndxf/x1MvmGgJVytQTbM+P15XsMMOzIlUJ4C2adUteow8DFgKboVefFB/IHdYoJDO\nFmAP1i4sZupk0brq6RRyN+mGFZtZ4YUxY/DpNqXz2jtzsCu8l2SFt2kCO8Qb4H1l\nnZGgF0Uwi8pXIAWgZik4lkPY/7H3jxmcdHpGo2Qc8QKBgQCW8uO74X3EM6aOFfX3\nQwB2Lrz7jAVeOE3tyVGbIxdsXTjXupNy1bDvy7HImNCE1HWF3bEHp8bVXLLWte/E\niF93WU8S1x5T2u9BFe/Cpq3x3ocTB6RB+4M8TYyds5oXwNvn2DmFD2RuEuIpPiKY\nUzVxJNQeMZIRB9QD/LN/t5oGtg==\n-----END PRIVATE KEY-----\n"

    @invalid_pkey = @valid_pkey[0..-3]

    @valid_cert = "-----BEGIN CERTIFICATE-----\nMIIDqTCCApGgAwIBAgIJAJCBuLXfgD0+MA0GCSqGSIb3DQEBCwUAMHIxCzAJBgNV\nBAYTAlVTMQswCQYDVQQIDAJPUjERMA8GA1UEBwwIUG9ydGxhbmQxFDASBgNVBAoM\nC0NTIEN1c3RvbWVyMRMwEQYDVQQLDApEZXBsb3ltZW50MRgwFgYDVQQDDA9sb2Nh\nbC51c3IuY2xvdWQwHhcNMTgxMjE1MDE0NjA4WhcNMjgxMjEyMDE0NjA4WjByMQsw\nCQYDVQQGEwJVUzELMAkGA1UECAwCT1IxETAPBgNVBAcMCFBvcnRsYW5kMRQwEgYD\nVQQKDAtDUyBDdXN0b21lcjETMBEGA1UECwwKRGVwbG95bWVudDEYMBYGA1UEAwwP\nbG9jYWwudXNyLmNsb3VkMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA\n2u+cNPEjjgXop3MmxgV/8xrWX3TRwA+UoiMO9tNGqlCNDIuiQUXym1rGnFkURnj/\n3RdD3eC2OKe+6GbOPYlvq+p7w2ksZ/TZhpJWdd3NzCKfNCxNDuo9eaftJbfc3cM9\nHFdGj8ssxRid0Ovp0zjv8h9bK8gmUsZqWampj8VLvxtM0JkMEUKS4OesNAo7fEa/\nXxP4zk1K3wIwAELvLJcuIKX0mfL1SnwPMlyRd96Ti2vdT0nduMl/UiqmmhqCxSk+\nh0RptFwnqNzBSOhx+ns8jv4nZr+ecmksPEy9chbWbe1MHb7L666rRguTSkSd/rpk\n/SdcGMwmWbKVFMNw989HPwIDAQABo0IwQDALBgNVHQ8EBAMCBDAwEwYDVR0lBAww\nCgYIKwYBBQUHAwEwHAYDVR0RBBUwE4IRKi5sb2NhbC51c3IuY2xvdWQwDQYJKoZI\nhvcNAQELBQADggEBAACWFdCu0KvdiLy0MqdMhS8KHNNZLGsJQ8U9X9sYlutt/yjf\n/l1oAsLqT4QxY02vvaaQqFzQn6Fg8deLrtu3/GjUTfrXzsPsU08Jqcp39tMnwOpz\nzqqc7KgiEddu19SLoYLxxxAmiUpvHMoQj8BENw7GwfSL1MTRSJqTeFCx+nTeRnVr\nJQUWGj3v+ZfYrSTu/cMso+3i1nDIYgSVQThjHX0373Btf1mWJ9X5ouIjnH/ozCVx\nDf+cMEKkGdadCSYEVvw3n4H1m8RmExWlNsVEJoXQCXuYWdY1pvDFQIy7JmbKJgsj\ntozJVxPGKwmvvSIEDjcAJgyfU0eGz+QTmEc8k10=\n-----END CERTIFICATE-----\n"

    @invalid_cert = @valid_cert[0..-3]

    @crt_from_another_month = "-----BEGIN CERTIFICATE-----\nMIIFYjCCBEqgAwIBAgISA2KRBDLdZW9gH8hEEdrmPeoIMA0GCSqGSIb3DQEBCwUA\nMEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQD\nExpMZXQncyBFbmNyeXB0IEF1dGhvcml0eSBYMzAeFw0yMDA0MTIwNjQzNDFaFw0y\nMDA3MTEwNjQzNDFaMCAxHjAcBgNVBAMTFWRldi5jb21wdXRlc3RhY2tzLm5ldDCC\nASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMR2rcOraT7MQxjo1hTGH+0n\nUE1uJQIa3OgLEpDUhv2Cs9gi0cMU806U2w7nr1h1GiWHZaRYW+fxs8rIWrZmPuQ6\nD4Ah01WY/eQtlqWz+c6AGIo2vtRzHAwg0TOna3kVSH2ODTu8+hef9HD99zJkJJUh\njzl7xJLSpN/V0t8QObzyIU//KyIntngbsIhXF7w0/iGiGr5rB6rwPTlArShy724H\n5wWE47shJRcR5tOENppWH14GfGTfWnd2UYlsSeO04XBD1ox2GUM1q0oe5HfOJEDz\nEgMKwoJdhGyuQYthCDxxnfUz0PP45BXvNR4AnTJr5PGOSULYCKBqvMbkwU4ql98C\nAwEAAaOCAmowggJmMA4GA1UdDwEB/wQEAwIFoDAdBgNVHSUEFjAUBggrBgEFBQcD\nAQYIKwYBBQUHAwIwDAYDVR0TAQH/BAIwADAdBgNVHQ4EFgQUCU+rSipdQqh/ml1S\n404Tp5Pz76UwHwYDVR0jBBgwFoAUqEpqYwR93brm0Tm3pkVl7/Oo7KEwbwYIKwYB\nBQUHAQEEYzBhMC4GCCsGAQUFBzABhiJodHRwOi8vb2NzcC5pbnQteDMubGV0c2Vu\nY3J5cHQub3JnMC8GCCsGAQUFBzAChiNodHRwOi8vY2VydC5pbnQteDMubGV0c2Vu\nY3J5cHQub3JnLzAgBgNVHREEGTAXghVkZXYuY29tcHV0ZXN0YWNrcy5uZXQwTAYD\nVR0gBEUwQzAIBgZngQwBAgEwNwYLKwYBBAGC3xMBAQEwKDAmBggrBgEFBQcCARYa\naHR0cDovL2Nwcy5sZXRzZW5jcnlwdC5vcmcwggEEBgorBgEEAdZ5AgQCBIH1BIHy\nAPAAdgBvU3asMfAxGdiZAKRRFf93FRwR2QLBACkGjbIImjfZEwAAAXFtWBTvAAAE\nAwBHMEUCIQDZyMYdIh74nT3MIE/4PfctJC1e4XwEQyHHuiadNOIzGQIgUpBVmfmh\nEITRH2O9PC/CcOfQIMkz4tRkIDUQgzMJbkwAdgAHt1wb5X1o//Gwxh0jFce65ld8\nV5S3au68YToaadOiHAAAAXFtWBTzAAAEAwBHMEUCIGerX9+cpiekrAi0idzML3NM\np133jLq0LDcZzPY0A3tPAiEAzimZLcjLntiLNhvUb5Yxvi8uYAiZc8wKESSgPZQu\nSmIwDQYJKoZIhvcNAQELBQADggEBAJwi/sJCE/q0Er13d0Tpy/HcdzEzb8dlA2kE\nKujadUhhxa1tw2awZ2esdeNyrjz1d2Re8drbzIVcHqUks4a5u2GJk4GwPSDtzDr/\n6PgRka0IQ984Kwuo1u0wrfk68ISQ/FRqCQDGI+MLJF8yiszU+tweo6PRL6eid8x5\ncwLZg3mIhnNnMwzBPVVieA/C1/qvXNYv2aUM00iHI/utrOzPV1Wzg3NGbhH3NANK\nCYjrjmBmD7dUte1g5JzvDYMyPNa4vJlLi5IHiLdTZPWzJV8Fsf8jReb7mNp1hpXk\n+4SpeCobZRzziMxT8rCCt4sqGA82+EIrwvhvAw/BrZAAW9DPdlY=\n-----END CERTIFICATE-----\n"

  end

  test 'ensure ssl certificates belong to a service' do
    new_ssl = Deployment::Ssl.new
    assert !new_ssl.valid?

    new_ssl.pkey = @valid_pkey
    new_ssl.crt = @valid_cert
    assert !new_ssl.valid? # No service/deployment yet!
    new_ssl.container_service = Deployment::ContainerService.first
    assert new_ssl.valid?
  end


  test 'will validate supplied certificate' do

    new_ssl = Deployment::Ssl.new
    new_ssl.container_service = Deployment::ContainerService.first

    # Invalid pkey
    new_ssl.pkey = @invalid_pkey
    new_ssl.crt = @valid_cert
    assert !new_ssl.valid?

    # Invalid Crt
    new_ssl.pkey = @valid_pkey
    new_ssl.crt = @invalid_cert
    assert !new_ssl.valid?

    # Valid pkey and crt, but crt is from a different pkey
    new_ssl.crt = @crt_from_another_month
    assert !new_ssl.valid?

  end

  test 'will validate CA certificate' do
    pkey = "-----BEGIN RSA PRIVATE KEY-----\nMIIEowIBAAKCAQEAswNu0qWIPFrSPu5LgIwjibkVUlpoSbXVeAR+8s2H2507AV9q\nntI2Cqzb1afHEoPLu3vWEg+s75E76NWxZJI4uMj2mb0M0SQnAAv9EixO/plUsS/z\nQmDNcvYXbdZYzqSF3Yi3bFTcIPOWgWtiawJtlBc18M93uAsz9zQuKMUL72XZGJjf\nUR5tXvm2AYhCsc1i5Ky/7cz8uhW/+w6ydku4fXsndI65Y0G3wZ2qcgFGuzHviXDK\n84AEdTPgBRxnlhFSth1FUUWzljhtVDqjIU6BMXOBXcMEG2xYUuVA13b/DuM+Xgwo\nJsZjIzGuJ5TRz2cUQptXQqMjfj8SRw/0srO1LQIDAQABAoIBACP8Dqz9ZXNsdlL8\nJ+VBRmuK7wRM9CXNDYpArRw1wJee9ZuDCLXAX+ipcs9yGIxaPfwEGrYqvIKz2S0m\nt7AVzJ0omJmy7P6lm8lgn5Clo4N+Yw3zK50uRF5VpcQIkHWJkPdFYkm+jTl6fciq\nQ3BrXoekWs17hv9SETIiJR1A7vNCWX1FT6bGf/XeSD0GJqUJOXODRObwJirlxptl\nUnwZ+47U6Foy3htusntyBLDXHi0LUjPk1/pgJmpo7t3QSEwMvwceitbcIqDUfXhE\nimDBTbsClc+ioLg5ttFk1v0rQcJNLNpweXH2fCamiqP0OBBPXTnftyh776zNNocR\nDrZ+9+kCgYEAwtu6yyeYUWIl5oMPOxQ/eliuXgEiFXXdMXOpHClztfmtglnTZzo0\npz/eSgnBLA0s9qzC6FovpZ1Apb0Sx+A07PpVwZWdAG0rnY8xRFOHwnXUluM8IUdL\nb1os7s3zp3NQbrblmqEF4Wldw+tH8p6lAJusPHJoGtmLaaX8MyxbbG8CgYEA6y7w\nP9gZleXueC3cQc+xJiH1H+28QRnINZWVbnmvK4BB8XOXSaSpxHw4Fjy52MM11t7z\nsCsDowA576WttRRR8PzE32MRaRrXwX3gKVcNPFYtsBmXKdE+gSSkubA8l0a22tp2\n9y+1HgQ9XjKHUtc5v9YY3SuoR1E+G1oAj6ufPiMCgYBpAy/0wj71RRa11tXDehMH\npXk7EhNDS4TMXM+7bJ9+Z7NZd31VuWmc5O+wKPeg/OzJd6uGuuvIrimj6HSRoUQE\nnpjOvgmhrDQAMqZTc0zLwOKz+nxyVtDRjuB+RiHUkXG8aPbuUW8w3q74ofjhSRwV\nas/0t5dhOPJIGnsDPRl8IwKBgQC35UsM0QAomtMd+9YnS6ycQZ83aSBz0yIe7Ckd\nal7TaAWoNBdPCUeKEQuWL8OuP+4gZtMrpGbClRG4Vtd+KTZtdmjGt+NMSSX98VxP\nVvdNf6FX+pqdozT5rFp1q92k+DFQ7dRqMk6v+ua1elMgLpTEcTed8V4y7c7fej/I\nF417+wKBgBjlHz9JBosZRY+rVafX4QUAv7NOKFUIGsL5teV7mu7vxIwUyYJCbAzf\nD9H1Hp+mxAudceUTn7LD5qL+lFgQAfhXWKwzdX338SkuoPrBGxfSQjYcg3Qj1dNK\ncxCur1ZEuyNWtcGldt/9k1ZJLleAPm3bx5WvbJUbjz+Xono89l5F\n-----END RSA PRIVATE KEY-----\n"
    cert = "-----BEGIN CERTIFICATE-----\nMIIDeTCCAmGgAwIBAgIUHdEHczjJhD6gNSdayJyZXKbdb3IwDQYJKoZIhvcNAQEL\nBQAwGTEXMBUGA1UEAxMOQ29uc3VsIFJvb3QgQ0EwHhcNMTkxMjA4MDA0NjUzWhcN\nMjQxMjA2MDA0NzIzWjAvMRYwFAYDVQQLEw1Db25zdWwgU2VydmVyMRUwEwYDVQQD\nEwxkZW1vLW5vZGUxMDEwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCz\nA27SpYg8WtI+7kuAjCOJuRVSWmhJtdV4BH7yzYfbnTsBX2qe0jYKrNvVp8cSg8u7\ne9YSD6zvkTvo1bFkkji4yPaZvQzRJCcAC/0SLE7+mVSxL/NCYM1y9hdt1ljOpIXd\niLdsVNwg85aBa2JrAm2UFzXwz3e4CzP3NC4oxQvvZdkYmN9RHm1e+bYBiEKxzWLk\nrL/tzPy6Fb/7DrJ2S7h9eyd0jrljQbfBnapyAUa7Me+JcMrzgAR1M+AFHGeWEVK2\nHUVRRbOWOG1UOqMhToExc4FdwwQbbFhS5UDXdv8O4z5eDCgmxmMjMa4nlNHPZxRC\nm1dCoyN+PxJHD/Sys7UtAgMBAAGjgaIwgZ8wDgYDVR0PAQH/BAQDAgWgMB0GA1Ud\nJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAdBgNVHQ4EFgQUJSFgNVNUy9UzshnH\n/wbjfAbhh9MwHwYDVR0jBBgwFoAUWQAwiOCHW9jGtaSJX5QNrnFf5McwLgYDVR0R\nBCcwJYIMZGVtby1ub2RlMTAxgglsb2NhbGhvc3SHBH8AAAGHBDOhacIwDQYJKoZI\nhvcNAQELBQADggEBAEE18dE/ZmLhWFnekUO+3vCw9M2Euswr9XkijKswYZ5xf87R\nZVlnBvLL14P0AWkp+j9vC8m1T58aSC8mZ4TirJeDW1k3YX0lcM3zA0n2IZUGdKs7\ni7cqrUWfQMcdClORMV+PbpVOdyzq7woUUOdG6DbQk2dcs0jcM5xgIOHd+/i+0t2A\njRLbjIwCZRFtaH33DWUyRj+cWKxPfIPdMCAzsyUEuYNFK15xsCJ96JDrQH44kGjP\n+b2YEHMFMri+zaF5YjxeR0E7nER1heoLq0Qi7ruO2ZV+OU/YXWWfiaQ0bMartGpj\ns9d/iW6T6+Whthm3nxgGYb+bJFxm86u7vgxFOJA=\n-----END CERTIFICATE-----\n"
    valid_ca = "-----BEGIN CERTIFICATE-----\nMIIDIzCCAgugAwIBAgIUVebNiKglzPFhw35+mVAq20uScc4wDQYJKoZIhvcNAQEL\nBQAwGTEXMBUGA1UEAxMOQ29uc3VsIFJvb3QgQ0EwHhcNMTkxMjA4MDAzMTQxWhcN\nMjkxMjA1MDAzMjExWjAZMRcwFQYDVQQDEw5Db25zdWwgUm9vdCBDQTCCASIwDQYJ\nKoZIhvcNAQEBBQADggEPADCCAQoCggEBAN7pjueCk8wkLfpHi95the05KW31Ndul\nCp6atyP1OzwKRTtXSXKkprfcz4v7SbBjZXuP9FaBxCTUUWUgrnf/6B9nMbM+iU1R\nweL/ikSZ+BbTtZVxGYnFiSHcySXf4xNkif2JTMk0T2Ff6M8UKujSN15tSMZW5CRS\ns74XJbKmluK7Dh/TPf3DRCjJZm/3CBznxHygjHLQW7BtkUCQFiuYkiik0qhAao5N\nijR2h8lVMdTfdpOcHUoGECwoCrKvPvLS/tMKgK/XZl3OOQBDpWCN2FUyRWSnAvsN
    5cc6toYhQ77WUsfsaIVL3rHr7vA620KlH26RaGl8ZnfzQddOyq6pNakCAwEAAaNj\nMGEwDgYDVR0PAQH/BAQDAgEGMA8GA1UdEwEB/wQFMAMBAf8wHQYDVR0OBBYEFFkA\nMIjgh1vYxrWkiV+UDa5xX+THMB8GA1UdIwQYMBaAFFkAMIjgh1vYxrWkiV+UDa5x\nX+THMA0GCSqGSIb3DQEBCwUAA4IBAQA7VFMKK2QxBhxZvYjjxnPoh/1DXXwnxy4O\nWfekjDxXPCWds1+gamWgC2fuL8sFZ4XyYyFTC3CDyc6ja+LEmKSGMamHKdlSftDg\nSsWayzxCjbDp2jKhYBiqdnYMboFor0x5ttAYIYwV/vutgYEw15d9yIiKfuWTv02p\nDJ6p8hopr4a96+X/RcJxr7SUFrN9pTERAXI2MfwqW6Is5coISICPv3FOyA6Bpme9\nsGl96FPrkR9M7pTV9dqfLmbltoe2PIswWSoCekBL196uQWogn1SrzH/2UBiMyXeU\nQLTZWPwCr1ctS9KJcgxYu9hsmR7x2isbNkCGfW5uZ8rPq0gYk31f\n-----END CERTIFICATE-----\n"

    invalid_ca = "-----BEGIN CERTIFICATE-----\nMIIDxDCCAqygAwIBAgIUMfvq8/ifwmi7hK8qUfSczuDBHqMwDQYJKoZIhvcNAQEL\nBQAwaDEVMBMGA1UEBxMMdGhlIGludGVybmV0MRYwFAYDVQQKEw1hdXRvZ2VuZXJh\ndGVkMRUwEwYDVQQLEwxldGNkIGNsdXN0ZXIxIDAeBgNVBAMTF2V0Y2QgYW5zaWJs\nZSBhdXRvZ2VuIENBMB4XDTE5MTIwODAwMzQwMFoXDTI0MTIwNjAwMzQwMFowaDEV\nMBMGA1UEBxMMdGhlIGludGVybmV0MRYwFAYDVQQKEw1hdXRvZ2VuZXJhdGVkMRUw\nEwYDVQQLEwxldGNkIGNsdXN0ZXIxIDAeBgNVBAMTF2V0Y2QgYW5zaWJsZSBhdXRv\nZ2VuIENBMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnll6SAYxKJIx\nskrQqSu5C0mlJCU6xWTk7QXkfPvVApG6+YfCY3YDRp2NmrtHb1yl0Wh/Q3fdqZAv\nybVSmKr4NyyapeFmi4CxjvbEHhQsY+lh9wBQXooGUDXp4RPWu57v346Y1d5NbRcb\nhLcHRdFIdRIqkvSjcsqRqmzjswr9Z0YiPgwTPq9c+HOHTYRJd4OTIgFESVDUXTxr\nYVXru4Ej9+Q3RINZn1PcT3mHCgF58fpWm5wzjJVLvTYY/TWzguJugSuqDDE0IcXy\nLPw5VW7hPyr2dKyryf7dUGAo4mqxnOFemG8Xrh0K7PwJF+eDvX4LFz8mMQYhI5k9\n+BKeDAYVEwIDAQABo2YwZDAOBgNVHQ8BAf8EBAMCAQYwEgYDVR0TAQH/BAgwBgEB\n/wIBAjAdBgNVHQ4EFgQUU5bFO/ahuW8oywYemJCiitQCQMswHwYDVR0jBBgwFoAU\nU5bFO/ahuW8oywYemJCiitQCQMswDQYJKoZIhvcNAQELBQADggEBAI3c5nCnuWwh\npI8zTqsyd0TD8W/Api1a6AMOXaqlCcfGmxwVu7uX820YjQjD5nWWu8BkXMjsbz6X\ndHK+K/M66VvCih4q9/OObGDf+YOeHxqa1qGWLP0sTbBAUXWwfQNT3+UBqmPi+5Xh\nJ/RoUdzLrG2UDbguD7kOf4n8V2fUz3dTyRn4uEYHXbzZgLcsLIv9QD++JmBg43Pj\n82kkyWxNLvOvdFaKf22XjDiX9DV10PBRIb9JBbDdjE4AWZJOs5fiJipPrl5PzPqY
    VelyWcQEEDPccPMvU5oVG+X/GnKU0N6P5LzjQFZJWkXAXQ9go4/qAeICqgrikM4I\n4mYPygiIaB4=\n-----END CERTIFICATE-----\n"

    new_ssl = Deployment::Ssl.new
    new_ssl.container_service = Deployment::ContainerService.first

    new_ssl.pkey = pkey
    new_ssl.crt = cert

    # Test without CA that this is valid.
    assert new_ssl.valid?

    # Valid with correct CA
    new_ssl.ca = valid_ca
    assert new_ssl.valid?

    # Invalid with wrong CA
    new_ssl.ca = invalid_ca
    assert !new_ssl.valid?

  end

end
